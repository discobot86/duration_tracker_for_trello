<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Duration Tracker Connector (Hours)</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 8px; }
      label { display: block; margin-top: 8px; font-size: 14px; }
      input[type="number"] {
        width: 100%;
        padding: 4px;
        margin-top: 4px;
      }
      button { margin-top: 12px; padding: 6px 12px; cursor: pointer; }
      #status { margin-left: 8px; font-size: 12px; color: green; }
    </style>
  </head>
  <body>
    <label for="planned-hr">Planned Duration (hrs):</label>
    <input
      type="number"
      id="planned-hr"
      min="0"
      step="0.25"
      placeholder="e.g. 0.25"
    />

    <label for="actual-hr">Actual Duration (hrs):</label>
    <input
      type="number"
      id="actual-hr"
      min="0"
      step="0.25"
      placeholder="e.g. 1.50"
    />

    <button id="save-btn">Save</button>
    <span id="status"></span>

    <script src="https://p.trellocdn.com/power-up.min.js"></script>
    <script>
      // Initialize the Trello Power-Up iframe context
      var t = TrelloPowerUp.iframe();

      // Use clear keys to store/retrieve hours rather than minutes
      const KEY_PLANNED = 'duration-tracker:planned-hr';
      const KEY_ACTUAL  = 'duration-tracker:actual-hr';

      // When the card back is rendered, load any saved values
      t.render(function() {
        return Promise.all([
          t.get('card', 'shared', KEY_PLANNED),
          t.get('card', 'shared', KEY_ACTUAL)
        ]).then(function(values) {
          document.getElementById('planned-hr').value = values[0] || '';
          document.getElementById('actual-hr').value  = values[1] || '';
        });
      });

      // When “Save” is clicked, write both values back into shared storage
      document.getElementById('save-btn').addEventListener('click', function() {
        // Read the numeric values (empty string → stored as "")
        var plannedVal = (document.getElementById('planned-hr').value || '').toString();
        var actualVal  = (document.getElementById('actual-hr').value  || '').toString();

        Promise.all([
          t.set('card', 'shared', KEY_PLANNED, plannedVal),
          t.set('card', 'shared', KEY_ACTUAL,  actualVal)
        ]).then(function() {
          document.getElementById('status').textContent = 'Saved!';
          setTimeout(function() {
            document.getElementById('status').textContent = '';
          }, 1500);
        });
      });
    </script>
  </body>
</html>
